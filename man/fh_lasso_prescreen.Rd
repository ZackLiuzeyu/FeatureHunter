% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/preprocessing.R
\name{fh_lasso_prescreen}
\alias{fh_lasso_prescreen}
\title{LASSO/Elastic Net-based Feature Prescreening with Flexible Strictness}
\usage{
fh_lasso_prescreen(
  x_train,
  y_train,
  x_tests = NULL,
  alpha = 1,
  nfolds = 10,
  nlambda = 100,
  intercept = FALSE,
  impute_median = TRUE,
  selection = c("lenient", "balanced", "conservative", "custom_fraction"),
  fraction = 0.5,
  min_keep = 0,
  max_keep = Inf,
  plot = c("none", "cv", "path", "both"),
  plot_file = NULL,
  plot_width = 7,
  plot_height = 5
)
}
\arguments{
\item{x_train}{matrix/data.frame; training expression data (rows = samples, cols = genes).}

\item{y_train}{factor/numeric/character; binary labels (two-level factor or convertible).}

\item{x_tests}{optional named list of matrices to be subset to the selected genes.}

\item{alpha}{numeric; Elastic Net mixing parameter (\code{1} = LASSO, \verb{0 < alpha < 1} = Elastic Net).}

\item{nfolds}{integer; number of folds for \code{cv.glmnet} cross-validation (default \code{10}).}

\item{nlambda}{integer; number of candidate lambda values (default \code{100}).}

\item{intercept}{logical; whether the final glmnet fit includes an intercept (default \code{FALSE}).}

\item{impute_median}{logical; whether to impute missing numeric values with medians (default \code{TRUE}).}

\item{selection}{character; lambda selection strategy: one of
\code{"lenient"}, \code{"balanced"}, \code{"conservative"}, \code{"custom_fraction"}.}

\item{fraction}{numeric in \verb{、code\{[0, 1]\}}; used only if \code{selection = "custom_fraction"}.
\code{0} = \code{lambda.min}, \code{1} = \code{lambda.1se}; default \code{0.5} = midpoint.}

\item{min_keep}{integer; minimum number of features to retain (default \code{0}).}

\item{max_keep}{integer; maximum number of features to retain (default \code{Inf}).}

\item{plot}{logical; if \code{TRUE}, draw the CV curve (default \code{TRUE}).}

\item{plot_file}{character or \code{NULL}; if non-\code{NULL}, save the plot to this path (without extension if you open a device inside).}

\item{plot_width}{numeric; plot width in inches when saving (default \code{7}).}

\item{plot_height}{numeric; plot height in inches when saving (default \code{5}).}
}
\value{
A list with:
\itemize{
\item \code{genes}: selected gene names.
\item \code{x_train}: reduced training matrix with selected genes.
\item \code{x_tests}: reduced test matrices with selected genes (if provided).
\item \code{cvfit}: \code{cv.glmnet} object (CV curve info).
\item \code{lambda_min}: optimal lambda from CV.
\item \code{lambda_1se}: conservative lambda from CV.
\item \code{lambda_used}: lambda actually used for selection.
}
If \code{plot = TRUE} and \code{plot_file} is non-\code{NULL}, a figure will also be written to disk.
}
\description{
Perform feature pre-screening using LASSO or Elastic Net regression on the training set.
Features are selected based on non-zero coefficients at a lambda chosen from cross-validation.
Users can control strictness (lenient/balanced/conservative/custom) to tune the number of selected features.
Optionally, test matrices are subset to the selected features.
A cross-validation curve (CV error vs. log(lambda)) can be plotted and optionally saved.
}
\details{
\itemize{
\item \code{x_train} should be a gene expression matrix (rows = samples, cols = genes).
\item \code{y_train} can be factor, numeric, or character vectors, but must be binary.
\item Missing values are imputed with the column median if \code{impute_median = TRUE}.
\item \code{cv.glmnet} determines \code{lambda.min} (most predictive) and \code{lambda.1se} (simpler, more regularized).
\itemize{
\item \strong{lenient} -> use \code{lambda.min} (more features).
\item \strong{conservative} -> use \code{lambda.1se} (fewer features, more stable).
\item \strong{balanced} -> midpoint on the log scale between \code{lambda.min} and \code{lambda.1se}.
\item \strong{custom_fraction} -> interpolate between \code{lambda.min} and \code{lambda.1se} (controlled by \code{fraction}).
}
\item Final coefficients are extracted at the chosen lambda. \code{min_keep} and \code{max_keep} bound the feature count.
}
}
\examples{
\dontrun{
set.seed(123)
x <- matrix(rnorm(1000), nrow = 50, ncol = 20)
colnames(x) <- paste0("gene", 1:20)
y <- sample(c(0, 1), 50, replace = TRUE)

# Lenient selection (lambda.min), with plot displayed
res1 <- fh_lasso_prescreen(x, y, selection = "lenient", plot = TRUE)

# Conservative selection (lambda.1se), save plot to file
res2 <- fh_lasso_prescreen(
  x, y, selection = "conservative",
  plot = TRUE, plot_file = "cv_curve_lasso.pdf",
  plot_width = 7, plot_height = 5
)

# Custom fraction (75\% towards conservative)
res3 <- fh_lasso_prescreen(x, y, selection = "custom_fraction", fraction = 0.75)

# Check selected genes
print(res1$genes)
}

}
\seealso{
\link[glmnet:cv.glmnet]{glmnet::cv.glmnet}, \link[glmnet:glmnet]{glmnet::glmnet}
}
