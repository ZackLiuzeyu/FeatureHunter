% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fh_dimreduce.R
\name{fh_dimreduce}
\alias{fh_dimreduce}
\title{Dimensionality reduction (PCA, ICA, PLS-DA) with gene ranking}
\usage{
fh_dimreduce(
  expr_path = NULL,
  meta_path = NULL,
  dir = NULL,
  train_exp_name = NULL,
  hub_file = "Common_genes.txt",
  positive_label = NULL,
  out_dir = file.path(getwd(), "preprocess"),
  max_components = 30L,
  min_genes = 200L,
  seed = 20240917L,
  normalize = TRUE,
  ica_method = "C",
  pls_ncomp_default = 10L,
  group_levels = NULL
)
}
\arguments{
\item{expr_path}{(Legacy) Path to expression matrix (tab-delimited).
First column must be gene IDs; remaining columns are samples.}

\item{meta_path}{(Legacy) Path to sample metadata (tab-delimited, no header).
Two columns: \code{Sample}, \code{Group}.}

\item{dir}{Directory containing training expression, label files, and hub file.
If provided (non-NULL), the function calls \code{fh_load_data()} and ignores
\code{expr_path/meta_path}.}

\item{train_exp_name}{Training expression file name inside \code{dir}.}

\item{hub_file}{Hub gene file name inside \code{dir}. Default: \code{"Common_genes.txt"}.}

\item{positive_label}{Positive class label for \code{fh_load_data()} to derive 0/1.}

\item{out_dir}{Output directory; defaults to \code{file.path(getwd(), "preprocess")}.
Created if it does not exist.}

\item{max_components}{Maximum number of components to fit for PCA/ICA (capped
internally by \code{min(ncol(X), nrow(X) - 1)}). Default: \code{30L}.}

\item{min_genes}{Minimum number of genes required to proceed. If the
expression matrix has fewer columns than this threshold, the function skips
reduction and returns early. Default: \code{200L}.}

\item{seed}{Random seed (L'Ecuyer-CMRG) for reproducibility. Default:
\code{20240917L}.}

\item{normalize}{Logical; if \code{TRUE}, scale features to zero mean and unit
variance before reduction. Default: \code{TRUE}.}

\item{ica_method}{\code{fastICA} algorithm method, e.g. \code{"C"}. Default:
\code{"C"}.}

\item{pls_ncomp_default}{Default supervised components for PLS-DA
(capped by matrix size). Default: \code{10L}.}

\item{group_levels}{Optional factor level order for \code{Group} (legacy mode only),
e.g. \code{c("Normal","Disease")}. Default: \code{NULL}.}
}
\value{
Invisibly returns a list with:
\itemize{
\item \code{out_dir}: resolved output directory
\item \code{prefix}: dataset prefix (training file name in dir-mode; or basename(expr_path))
\item \code{n_samples}: number of samples used
\item \code{n_genes}: number of genes used
\item \code{max_components}: effective component cap
}
}
\description{
Performs PCA, ICA, and supervised PLS-DA (via mixOmics), exports per-sample
scores and PCA variance explained, and computes a fused gene-level importance
by combining PCA, ICA, and PLS-DA loadings. Outputs are saved under
\code{file.path(getwd(), "preprocess")} with a dataset-specific prefix.
You can either:
\itemize{
\item \strong{Dir mode} (preferred): provide \code{dir}, \code{train_exp_name},
\code{hub_file}, and \code{positive_label}. The function will call
\code{fh_load_data()} to load, align, and hub-filter data.
\item \strong{Legacy mode}: provide \code{expr_path} and \code{meta_path}.
}
If the number of genes is below \code{min_genes}, the function exits early and
reports "no reduction needed".
}
\details{
\strong{Dir mode (via \code{fh_load_data()}):}
data are aligned and hub-filtered to the intersection of hub genes and
cross-dataset common genes. \code{Group} is taken from \code{y_train} as "0"/"1".

\strong{Outputs written to \code{out_dir}} (prefix as above):
\itemize{
\item \code{*_PCA_scores.csv}, \code{*_PCA_var_explained.csv}, \code{*_PCA_scree.png}
\item \code{*_ICA_scores.csv}
\item \code{*_PLS_scores.csv}
\item \code{*_reduced_concat.csv} (with \code{Sample, Group})
\item \code{*_gene_ranking_all.csv}, \code{*_gene_ranking_combo_pos.csv}
\item \code{*_expr_combo_pos_scaled.tsv} (always)
\item \code{*_expr_combo_pos_raw.tsv} (legacy mode only)
\item \code{*_combo_pos_gene_list.txt}
}
}
\examples{
\dontrun{
# Legacy mode
res1 <- fh_dimreduce(
  expr_path = "DatasetD.txt",
  meta_path = "SampleD.txt",
  min_genes = 200,
  max_components = 30,
  pls_ncomp_default = 10,
  group_levels = c("Normal","Disease")
)

# Dir mode (preferred)
res2 <- fh_dimreduce(
  dir = "dir_sample",
  train_exp_name = "DatasetD.txt",
  hub_file = "Common_genes.txt",
  positive_label = "Disease",
  max_components = 30,
  min_genes = 200
)
}

}
